<html>

<head>
	<meta charset="utf-8">
	<link href="jquery/jquery-ui.css" rel="stylesheet">
	<style>
		#section {
		width: 200px;
		}

		.Search {
		display: block;
		}

	</style>
	<script src="jquery/jquery.js"></script>
	<script src="jquery/jquery-ui.js"></script>
	<script>
      (function() {
        function getSections() {
          var sections = (function() {
            var json = [];
            $.ajax({
              'async': false,
              'global': false,
              'url': "/types",
              'dataType': "json",
              'success': function(jsonTypes) {
                for (var i in jsonTypes)
                  json.push(jsonTypes[i].name);
              }
            });
            return json;
          })();

          buildSections(sections);
        };

        function buildSections(array) {
          var html = "";
          for (var i in array) {
            html += "<option value='" + array[i] + "'>" + array[i] + "</option>";
          }
          $("#section").html(html);

          if (array.length > 0)
            getDocuments(array[0]);
        };

        function onSectionChange() {
          getDocuments($("#section").val());
        };

        function onAddDocumentBtnClick() {
          alert("Add");
        };

        function onSearchBtnClick() {
          var text = $("#searchField").val();
          alert("search: " + text);
        };

        function getDocuments(section) {

          $.getJSON("/documents?type=" + section, function(jsonDocuments) {
            buildDocumentsTable(jsonDocuments);
          });

        };

        function buildTableHeader() {
          var tableHead = "";
          var columns = ["Название", "Дата добавления", "Пользователь"];
          tableHead += "<tr>";
          for (var i in columns) {
            tableHead += "<th>" + columns[i] + "</th>";
          }
          tableHead += "</tr>";
          $('#documents').append(tableHead);
        };

        function buildDocumentsTable(documents) {

          $("tr:has(td)").remove();

          var tableContent = "";
          //    tableContent+=documents;
          for (var d in documents) {
            //var doc = JSON.parse(documents[d]);
            var doc = documents[d];
            tableContent += "<tr><td>" + doc.name + "</td><td>" + doc.dateCreated + "</td><td>" + doc.creator.name + "</td></tr>";
          }
          $('#documents').append(tableContent);
        };

        $(document).ready(function() {
          buildTableHeader();
          getSections();

          $("#addDocumentBtn").on("click", onAddDocumentBtnClick);
          $("#searchBtn").on("click", onSearchBtnClick);
          $("#section").on("change", onSectionChange);
        });
      })();

    </script>
</head>

<body>
<label for="section">
	Выберите тип</label>
<select name="section" id="section"></select>
<input id="addDocumentBtn" type="button" value="Прикрепить" />
<div class="Search">
	<input type="text" id="searchField">
	<input id="searchBtn" type="button" value="Найти" />
</div>
<table id="documents" border='1'></table>
</body>

</html>